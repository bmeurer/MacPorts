# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
name                arm-linux-gnueabi-binutils
version             2.21.1
categories          cross devel
maintainers         googlemail.com:benedikt.meurer
license             GPL-3+
description         FSF Binutils for arm-linux-gnueabi cross development
long_description    Free Software Foundation development toolchain ("binutils") for \
                    arm-linux-gnueabi cross development.

homepage            http://www.gnu.org/software/binutils/binutils.html
platforms           darwin
master_sites        gnu:binutils
distname            binutils-${version}a
worksrcdir          binutils-${version}
use_bzip2           yes
universal_variant   no
checksums           md5     bde820eac53fa3a8d8696667418557ad \
                    sha1    525255ca6874b872540c9967a1d26acfbc7c8230 \
                    rmd160  de5ce1d7cb0d44e3ec18c557beefb2a292d59a60

# Parameters for this port.
set crossgcc-target arm-linux-gnueabi

depends_lib-append  port:zlib

patchfiles          110-arm-eabi-conf.patch \
                    300-001_ld_makefile_patch.patch \
                    120-sh-conf.patch \
                    300-012_check_ldrunpath_length.patch
patch.pre_args      -p1

# All cross ports violate the mtree layout
destroot.violate_mtree  yes

# Build in a different directory, as advised in the README file.
pre-configure {
    file mkdir "${workpath}/build"
}
configure.dir       ${workpath}/build
configure.cmd       ${worksrcpath}/configure
configure.args      --infodir='${prefix}/share/info' \
                    --target=${crossgcc-target} \
                    --program-prefix=${crossgcc-target}- \
                    --mandir='${prefix}/share/man' \
                    --with-float=soft \
                    --with-pkgversion='MacPorts 2011/11/26' \
                    --with-sysroots \
                    --disable-multilib \
                    --disable-nls \
                    --disable-werror
if {${os.platform} == "darwin" && ($build_arch == "x86_64" || $build_arch == "ppc64")} {
    configure.args-append   --build=${build_arch}-apple-darwin${os.version} \
                            --host=${build_arch}-apple-darwin${os.version}
}
build.dir           ${workpath}/build

# The Makefile runs configure again in subdirectories.
# It correcty passes along most configure variables (CFLAGS,
# LDFLAGS, ...), but seems to neglect CPPFLAGS.
build.env           CPPFLAGS='-I${prefix}/include'

# We don't want the etc module
post-extract {
    system "rm -rf ${worksrcpath}/etc"
}

post-destroot {
    file delete -force "${destroot}${prefix}/share/info"
    # Installing (host) libiberty was a mistake.
    foreach f [glob -directory "${destroot}${prefix}/lib" libiberty.a */libiberty.a] {
        file delete $f
    }
}

livecheck.type      freshmeat
livecheck.name      binutils
