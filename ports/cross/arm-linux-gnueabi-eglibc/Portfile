# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4
# $Id$

PortSystem          1.0
name                arm-linux-gnueabi-eglibc
version             2.11.2
categories          cross devel
maintainers         googlemail.com:benedikt.meurer
license             LGPL-2+
description         arm-linux-gnueabi eglibc, headers and import libraries.
long_description    arm-linux-gnueabi eglibc, headers and import libraries, \
                    taken from Emdebian.

# Parameters for this port
set crossgcc-target arm-linux-gnueabi
set debian-revision 13
set debian-version ${version}-${debian-revision}

homepage            http://www.emdebian.org/
platforms           darwin
supported_archs     noarch
master_sites        http://www.emdebian.org/debian/pool/main/e/eglibc/
distfiles           libc-bin-armel-cross_${debian-version}_all.deb \
                    libc-dev-bin-armel-cross_${debian-version}_all.deb \
                    libc6-armel-cross_${debian-version}_all.deb \
                    libc6-dev-armel-cross_${debian-version}_all.deb
worksrcdir          eglibc-${debian-version}
checksums           libc-bin-armel-cross_${debian-version}_all.deb \
                        md5 ac8dea5e988dcf3dac733fd709965e93 \
                    libc-dev-bin-armel-cross_${debian-version}_all.deb \
                        md5 5e0bfa78bd982bce28305909e48391f4 \
                    libc6-armel-cross_${debian-version}_all.deb \
                        md5 5fddea306b6ef6c6115a1f887112338e \
                    libc6-dev-armel-cross_${debian-version}_all.deb \
                        md5 2a96da79685eeae87a27f0d200e5f88e

depends_build       bin:dpkg:dpkg


# All cross ports violate the mtree layout
destroot.violate_mtree  yes

extract.suffix      .deb
extract.cmd         dpkg
extract.pre_args    -x
extract.post_args   ${worksrcpath}
post-extract {
    namespace eval crossgcc {}

    # Fix the installation prefix in .so files (ld linker scripts)
    #
    # path: path to the .so file
    proc crossgcc::fixld { path } {
        global crossgcc-target prefix

        reinplace "s|/usr/${crossgcc-target}|${prefix}/${crossgcc-target}|g" \
            ${path}
    }

    # Fix installation prefix in ld linker scripts
    crossgcc::fixld "${worksrcpath}/usr/${crossgcc-target}/lib/libc.so"
    crossgcc::fixld "${worksrcpath}/usr/${crossgcc-target}/lib/libpthread.so"
}
use_configure       no
build {}
destroot {
    # Install files by copying them
    xinstall -d ${destroot}${prefix}/
    file copy ${worksrcpath}/usr/${crossgcc-target} ${destroot}${prefix}/
}
